
---

# Порядок рендера компонентов и вызова хуков в React

В React важно понимать порядок рендера компонентов и вызова хуков, особенно для оптимизации производительности и отладки.

---

## Порядок рендеринга компонентов

Когда React начинает рендер, он выполняет следующие шаги:

1. **Вызов родительского компонента**  
   React вызывает функцию родительского компонента, чтобы получить его JSX.

2. **Рекурсивный рендер дочерних компонентов**  
   В JSX родителя React находит все вложенные компоненты и вызывает их один за другим.

3. **Построение виртуального DOM**  
   На основе всех JSX-выражений строится виртуальное дерево компонентов.

4. **Сравнение (diffing) и обновление DOM**  
   React сравнивает новое дерево с предыдущим и обновляет только изменившиеся части реального DOM.

---

## Порядок вызова хуков

React вызывает хуки в строго определённом порядке, чтобы корректно сопоставлять их значения между рендерами.

- **useState, useReducer, useContext и другие синхронные хуки**  
  Вызываются сразу во время рендера компонента, в порядке объявления в функции.

- **useLayoutEffect**  
  Выполняется после обновления DOM, но до того, как браузер прорисует изменения. Полезен для измерения DOM и синхронного взаимодействия с layout.

- **useEffect**  
  Вызывается после того, как браузер уже отрисовал страницу. Используется для побочных эффектов, подписок, асинхронных операций.

---

## Важно: не нарушайте порядок вызова хуков

React жёстко отслеживает порядок вызова хуков между рендерами. Нарушение приводит к ошибкам и некорректной работе.

Нельзя вызывать хуки внутри:

- условий (`if`),
- циклов (`for`, `while`),
- вложенных функций.

**Плохо:**

```JS <code>
if (show) {
  useEffect(() => {}, []);
}
</code>
```

**Правильно:**

```JS <code>
useEffect(() => {
  if (show) {
    // логика
  }
}, [show]);
</code>
```

---

## Полная последовательность вызовов в рендере React

1. Вызов компонента (родительский затем дочерние)
2. Вызов хуков: `useState`, `useRef`, `useContext`
3. Формирование JSX
4. Сравнение с предыдущим виртуальным деревом
5. Обновление DOM
6. Вызов `useLayoutEffect`
7. Отрисовка браузером
8. Вызов `useEffect`

---

## Итог

- React сначала вызывает рендер родительского компонента, затем рекурсивно дочерних.
- Хуки вызываются в порядке объявления в теле компонента.
- `useState` и `useEffect` – это механизмы жизненного цикла компонентов.
- `useLayoutEffect` – синхронный эффект, `useEffect` – асинхронный относительно рендера.
- Нарушение порядка вызова хуков приводит к ошибкам исполнения.

---

Источник: [Порядок рендера и вызова хуков в React — hackfrontend](https://www.hackfrontend.com/docs/react/order-of-rendering-components-and-calling-hooks)[1]

[1](https://ru.react.dev/learn/render-and-commit)
[2](https://habr.com/ru/articles/843192/)
[3](https://ru.legacy.reactjs.org/docs/rendering-elements.html)
[4](https://habr.com/ru/companies/otus/articles/595321/)
[5](https://nuancesprog.ru/p/22012/)
[6](https://reactdev.ru/archive/react16/conditional-rendering/)
[7](https://www.youtube.com/watch?v=AcflYn8snMo)
[8](https://ru.react.dev/learn/rendering-lists)
[9](https://ru.legacy.reactjs.org/docs/react-component.html)
[10](https://digital-sector.ru/blog/technology/memoizatsiya-i-rendering-v-react/)
